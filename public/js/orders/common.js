// Generated by CoffeeScript 1.12.7
(function() {
  var checkPrice, search_warehouses;

  checkPrice = function() {
    var delivery_cost, discount, sum;
    sum = 0;
    discount = $('#discount').val;
    delivery_cost = $`#delivery_cost`.val;
    $('.product').each(function() {
      return sum += +$(this).find('.sum').val;
    });
    $('#sum').val(sum);
    return $('#full_sum').val(sum - discount + delivery_cost);
  };

  search_warehouses = function(city_id) {
    return $.ajax({
      type: 'post',
      url: '/api/search_warehouses',
      data: {
        city: city_id
      },
      success: function(answer) {
        return $('#warehouse').html(answer).removeAttr('disabled');
      }
    });
  };

  $(document).on('keyup', '.amount, .price', function() {
    var $product, amount, price;
    $product = $(this).parents('.product');
    amount = $product.find('.amount').val;
    price = $product.find('.price').val;
    $product.find('.sum').val(amount * price);
    return checkPrice();
  });

  $(document).on('keyup', '#delivery_cost, #discount', checkPrice);

  $(document).on('change keyup', '#search_field, #search_category', function() {
    var $this, data;
    $this = $(this);
    data = {
      search: $this.val,
      type: $this.data('search')
    };
    return $.post('/orders/search_products', data, function(res) {
      return $('.products').html(res);
    });
  });

  $(document).on('click', '.searched', function() {
    var id;
    id = $(this).data('id');
    $.post('/orders/get_product', {
      type: type,
      id: id
    }, function(res) {
      return $('#product-list tbody').append(res);
    });
    return checkPrice;
  });

  $(document).on('change', '#city_select', function() {
    var $selected, text, value;
    $selected = $(this);
    text = $selected.find('option:selected').text;
    value = $selected.val;
    $('#city_input').val(text);
    search_warehouses(value[0])();
    return $('#city').attr('value', value);
  });

  $(document).on('focus', '#city_input', function() {
    return $('#city_select').parents('.form-group').css('display', 'block');
  });

  $(document).on('keyup', '#city_input', function() {
    if ($('#city_input').val().length > 2) {
      return 0;
    }
    return $.ajax({
      type: 'post',
      url: '/api/get_city',
      data: {
        key: '123',
        str: $('#city_input').val()
      },
      success: function(answer) {
        return $('#city_select').html(answer);
      },
      error: function(answer) {
        return errorHandler(answer);
      }
    });
  });

  $(document).ready(function() {
    return $("#street").autocomplete({
      source: function(request, response) {
        return $.ajax({
          type: 'post',
          url: '/api/search_streets',
          data: {
            city: 'Kiev',
            street: $('#street').val()
          },
          success: function(data) {
            return response(data);
          }
        });
      },
      minLength: 3
    });
  });


  /*
          select: (event, ui) ->
              console.log(ui)
          open: ->
              $(this).removeClass("ui-corner-all").addClass("ui-corner-top");
          close: ->
              $(this).removeClass("ui-corner-top").addClass("ui-corner-all");
  
      $(document).on 'keyup', '#street', ->
              $this = $(@)
              $('#street_select_container').show();
              $.ajax({
                  type: 'post',
                  url: url('/api/search_streets'),
                  data: {
                      city: 'Київ',
                      street: $this.val()
                  },
                  success: function (answer) {
                      $('#street_select').html(answer);
              },
              error: function (answer) {
                  errorHandler(answer)
  
  
  
          $body.on('change', '#street_select', function () {
              $('#street').val($('#street_select :selected').text());
          $('#street_select_container').hide();
          });
  
          $body.on('keyup', '#city', function () {
              $('#city_select_container').show();
          var $this = $(this);
          $.ajax({
              type: 'post',
              url: url('/api/search_village'),
              data: {
                  name: $this.val()
              },
              success: function (answer) {
                  $('#city_select').html(answer);
          },
          error: function (answer) {
              errorHandler(answer);
          }
          })
          });
  
          $body.on('change', '#city_select', function () {
              $('#city').val($(this).find(':selected').val());
          $('#city_select_container').hide();
          });
          })
   */

}).call(this);
