// Generated by CoffeeScript 2.4.1
(function() {
  var filterOrders;

  filterOrders = function() {
    var data;
    data = {};
    $('.search').each(function(i, e) {
      return data[$(e).attr('id')] = $(e).val();
    });
    return GET.setObject(data).unsetEmpty().unset('page').go();
  };

  $(document).on('change', 'select.search', filterOrders);

  $(document).on('click', '#search', filterOrders);

  $(document).on('keyup', '.search', function(e) {
    if (e.which === 13) {
      return filterOrders();
    }
  });

  $(document).on('click', '#export_xml', function() {
    var ids;
    ids = [];
    $('.order_check:checked').each((index, element) => {
      return ids.push($(element).data('id'));
    });
    if (!ids.length) {
      return alert('Ви не позначили жодного замовлення для експотування!');
    }
    return $.ajax({
      type: 'post',
      url: '/orders/export',
      data: {ids},
      success: answer(function() {
        return successHandler(answer);
      })
    });
  });

  $(document).on('click', '.print_button', function() {
    var $print, $this;
    $this = $(this);
    $print = $($this.data('id'));
    $(`.buttons:not(.buttons${$this.data('id')})`).hide();
    if (($print.css('display') === 'none')($print.show())) {

    } else {
      return $print.hide();
    }
  });

  $(document).on('change', '.courier', function() {
    var courier_id, order_id;
    order_id = $(this).parents('tr').attr('id');
    courier_id = $(this).find(':selected').val();
    return $.ajax({
      type: 'post',
      url: '/orders/update_courier',
      data: {order_id, courier_id},
      success: answer(function() {
        return successHandler(answer, true);
      }),
      error: answer(function() {
        return errorHandler(answer);
      })
    });
  });

  $(document).on('click', '.preview', function() {
    var $parent, $preview_container, id;
    $parent = $(this).parents('tr');
    $preview_container = $parent.find('.preview_container');
    id = $parent.attr('id');
    if ($preview_container.html() !== '') {
      return $preview_container.html('');
    }
    $('.preview_container').each(function(index, element) {
      return $(element).html('');
    });
    return $.ajax({
      type: 'post',
      url: '/orders/preview',
      data: {id},
      success: function(answer) {
        return $preview_container.html(answer);
      },
      error: function(answer) {
        return errorHandler(answer);
      }
    });
  });

  $(document).on('click', '#route_list', function() {
    var url;
    url = '';
    $('.order-row').each(function(i, e) {
      return url += ':' + $(e).attr('id');
    });
    return window.open(`/orders/route_list?ids=${url}`, '_blank');
  });

  $(document).on('click', '#more_filters', function() {
    return $('.filter_more').toggleClass('none');
  });

  $(document).ready(function() {
    var cache;
    $('.search#phone').inputmask('999-999-99-99');
    $('#phone').inputmask("999-999-99-99");
    $('#phone2').inputmask("999-999-99-99");
    cache = {};
    return $('#fio, #street').autocomplete({
      source: (request, response) => {
        var term;
        term = request.term;
        if (term in cache) {
          return response(cache[term]);
        }
        return $.ajax({
          type: 'post',
          url: '/orders/view_auto_complete',
          data: {
            search: term,
            field: 'fio',
            type: JData.type
          },
          success: function(data) {
            cache[term] = data;
            return response(data);
          }
        });
      },
      minLength: 3
    });
  });

}).call(this);
